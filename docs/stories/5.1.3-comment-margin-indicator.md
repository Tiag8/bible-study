# Story 5.1.3: Indicador Visual na Margem

**Epic**: 5.1 - Comentarios Inline no Editor (estilo Notion)
**Status**: Done âœ… (implementado e removido por decisao UX)
**Priority**: Media
**Story Points**: 3
**Assignee**: @dev
**Depends On**: Story 5.1.1 (Comment Mark)

---

## USER STORY

**Como** um estudioso biblico
**Quero** ver icones na margem do editor indicando onde ha comentarios
**Para** identificar rapidamente quais trechos do estudo possuem anotacoes

### Why This Matters
- Navegacao rapida entre comentarios sem precisar escanear todo o texto
- Indicador visual sutil que nao polui a leitura
- Padrao conhecido de editores (VS Code, Google Docs)

---

## CRITERIOS DE ACEITACAO

### A. Icone na Margem

```gherkin
Scenario: Linhas com comentario exibem icone na margem
  Given o estudo tem 3 comentarios em paragrafos diferentes
  When visualizo o editor
  Then vejo 3 icones MessageSquare na margem esquerda
  And cada icone esta alinhado com a linha do respectivo comentario

Scenario: Linhas sem comentario nao exibem icone
  Given um paragrafo nao tem nenhum comentario
  When visualizo o editor
  Then nao ha icone na margem desse paragrafo
```

**Tarefas Tecnicas**:
- [x] ~~Criar `CommentMarginIcon.tsx`~~ (implementado via CSS `::before`, depois removido)
- [x] ~~Usar CSS `::before` pseudo-element~~ (implementado e removido por UX)
- [x] ~~Icone MessageSquare inline SVG~~ (implementado a 50% opacity, removido)
- [x] ~~Cor sutil amber~~ (implementado, removido - highlight + underline suficiente)
- [x] ~~Posicionar na margem esquerda~~ (overlapping com texto adjacente)

---

### B. Interacao com Icone

```gherkin
Scenario: Click no icone foca o trecho comentado
  Given vejo icone na margem de um paragrafo
  When clico no icone
  Then editor faz scroll ate o trecho comentado (se nao visivel)
  And o trecho comentado recebe um flash de highlight temporario (feedback visual)
```

**Tarefas Tecnicas**:
- [x] Flash animation implementada (400ms pulse) no mobile tap
- [x] ~~Click no icone~~ (removido junto com icone de margem)
- [x] ~~ScrollIntoView~~ (nao necessario sem icone de margem)
- [x] Flash de highlight implementado como feedback visual no tap

---

### C. Responsividade

```gherkin
Scenario: Mobile exibe icone menor e touch-friendly
  Given estou em dispositivo mobile (< 768px)
  When visualizo editor com comentarios
  Then icones na margem sao menores mas ainda visiveis (12px)
  And area de toque e adequada (min 32x32px hitbox)

Scenario: Margem nao quebra layout em telas pequenas
  Given editor esta em tela < 640px
  When ha icones na margem
  Then conteudo do editor nao e empurrado ou sobreposto
```

**Tarefas Tecnicas**:
- [x] Responsive: icone margem escondido em mobile (< 640px) - decisao final: removido completamente
- [x] Hitbox nao necessaria (icone removido)
- [x] Margem testada e causou overlap - removida por decisao UX
- [x] Decisao final: usar apenas highlight + underline (mais limpo)

---

## ABORDAGEM TECNICA

**Opcao recomendada**: Tiptap Plugin com decorations

O Tiptap/ProseMirror permite criar `Decorations` que renderizam widgets na margem. Essa abordagem:
- Nao modifica o documento (decorations sao visuais)
- Atualiza automaticamente quando marks mudam
- Segue o padrao ProseMirror (performatico)

```typescript
// Pseudocodigo da abordagem
Plugin({
  props: {
    decorations(state) {
      // Percorre doc buscando marks 'comment'
      // Para cada mark encontrado, cria widget decoration na margem
      return DecorationSet.create(state.doc, decorations)
    }
  }
})
```

**Alternativa simples**: CSS `::before` pseudo-element no `.comment-highlight` com `position: absolute` e `left` negativo. Mais simples mas menos flexivel.

---

## ARQUIVOS MODIFICADOS (Previsao)

| Arquivo | Acao | Descricao |
|---------|------|-----------|
| `src/components/Editor/CommentMarginIcon.tsx` | NOVO | Componente do icone ou plugin |
| `src/components/Editor/index.tsx` | EDITAR | Registrar plugin/decoration |
| `src/app/globals.css` | EDITAR | Estilos do icone na margem |

---

## QUALITY GATES

**Pre-Commit**:
- [x] `npm run build` passa sem erros
- [x] `npm run lint` passa sem warnings
- [x] ~~Icones na margem~~ (implementados e removidos - UX decision)
- [x] Flash animation funciona como feedback visual

**Pre-PR**:
- [x] Testado com multiplos comentarios
- [x] Testado em desktop e mobile
- [x] Layout limpo sem icones de margem (decisao UX)
- [x] Nenhuma regressao em funcionalidades existentes
- [x] Performance aceitavel

---

## NOTAS PARA @dev

1. **Comece pela abordagem simples** (CSS `::before`) e so migre para Plugin se necessario
2. **Nao bloquear**: Esta story e independente da 5.1.2, pode ser feita em paralelo
3. **Se margem causar problemas de layout**: e aceitavel esconder em mobile e manter apenas highlight
4. **Performance**: Decorations ProseMirror sao recalculadas a cada transacao, mas sao leves para poucos comentarios
